#!/usr/bin/perl
use autodie;
$_=q!$SIG{INT}=sub{5}6t=' 'x86l=`%lines`6o=+`%cols`6O=' 'x$o6h='';@C=()6,=$/;W clear");for$F(@ARGV) {$f=9=$b=06v=-16K='';open$H,"<$F";chomp(@L=<$H>);close$H;while($f>-1){system"%civis;%cup 0 0"6M=$v<0||$v>9?9:$v6X=$v<9?9:$v6D=$X-$M+1;for$x($f..$f+$l-1){$_=zx]||"";s/\t/$t/g6_.=$O;print"\033[".($v<0||$x<$M||$x>$X?"":"7")."m".substr($_,0,$o)}print"\033[m";W cnorm;%cup ".(9-$f)." 0;stty -icanon -echo min 1");sysread STDIN,$k,1;56_=$k;if(/jY9++if9<$#LBkY9--if9>0BvY$v=$v<0?9:-1BQ/^/QY9=-1BZ/^/ZY9=-2B:/||(/@/&&$v>-1)){W cup ".($l-1)." 0");print$O."\r"6C=`bash -c "read -rep :4`;if(/@Y@_=@L[$M..$X];eval$C;UM,$D,@_}else{E_=zx];eval$C;zx]=$_}}BJYif($v<0){$X++;$D++}$_='';E_.=zx]." "}UM,$D,$_6v=-1B[dy]Y@C=@L[$M..$X];UM,$D if/d/6c--if9>$#L6v=-1BhYEh.=zx]}$v=-1}elsif($v<0){9++if/[op]/;if(/eY$C='bash -c "';if(''ne$h){$h=~s/'/'"'\\\\''"'/g6C.=q#read -rei 'HINT: "'#.$h.q#'"';#6h=''}zc]=~s/'/'"'\\\\''"'/g6C.=q#read -rei '"'#.zc].q#'"'4#6_=`$C`;zc]=$_BS/^/SYzc+1]=~s/(.)(.*)/$2/;zc].=$1BSYzc]=~s/(.)(.*)/$2/;Uc,0,$1B[oO]YUc,0,''B[pP]YUc,0,@C}}$K=$k6f=9 if9<$f6f=9-$l+1if9>=$f+$l}if($f==-2){open$H,">$F";print$H@L;close$H}}W reset")!;
s!%!tput !g;s!Y!/){!g;s!E!for\$x(\$M..\$X){\$!g;s!B!}elsif(/!g;s!U!splice\@L,\$!g;s!W!system("tput !g;s!z!\$L[\$!g;s!4!;printf '%s' "'"'"\\\$REPLY"'"'!g;s!5!system"stty icanon echo"!g;s!6!;\$!g;s!9!\$c!g;s!\^!&&\$K=~!g;eval
